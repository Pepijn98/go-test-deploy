name: Deploy
# Controls when the action will run.
on:
    release:
        type: [released]
env:
    PASSWORD: ${{ secrets.PASSWORD }}
# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
    # This workflow contains a single job called "build"
    build:
        # The type of runner that the job will run on
        runs-on: ubuntu-latest
        # Steps represent a sequence of tasks that will be executed as part of the job
        steps:
            - name: Deploy using ssh
              uses: appleboy/ssh-action@master
              with:
                  host: ${{ secrets.HOST }}
                  username: ${{ secrets.USER }}
                  key: ${{ secrets.DEPLOY_KEY }}
                  port: 22
                  script: |
                      cd ~/projects/gotest
                      git pull origin master
                      git status
                      ./bin/deploy.sh
                      echo $PASSWORD | sudo -S systemctl restart gotest
